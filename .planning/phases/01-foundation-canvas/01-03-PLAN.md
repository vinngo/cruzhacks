---
phase: 01-foundation-canvas
plan: 03
type: execute
wave: 2
depends_on: [01-01]
files_modified:
  - app/workspace/page.tsx
  - components/workspace/ProblemPanel.tsx
  - components/workspace/CanvasPanel.tsx
  - components/TldrawEditor.tsx
autonomous: true

must_haves:
  truths:
    - "User sees three-panel workspace layout"
    - "Canvas is visually dominant (80% width)"
    - "User can draw and write on canvas"
    - "Canvas work persists across page refreshes during session"
    - "Drawing tools are accessible (pen, shapes, eraser)"
  artifacts:
    - path: "app/workspace/page.tsx"
      provides: "Three-panel workspace layout using react-resizable-panels"
      min_lines: 50
      exports: ["default"]
    - path: "components/TldrawEditor.tsx"
      provides: "tldraw canvas with localStorage persistence and minimal UI"
      min_lines: 60
      exports: ["default"]
    - path: "components/workspace/ProblemPanel.tsx"
      provides: "Left panel with placeholder content"
      min_lines: 20
      exports: ["default"]
    - path: "components/workspace/CanvasPanel.tsx"
      provides: "Center panel wrapper for tldraw"
      min_lines: 15
      exports: ["default"]
  key_links:
    - from: "app/workspace/page.tsx"
      to: "components/TldrawEditor"
      via: "dynamic import with ssr: false"
      pattern: "dynamic.*TldrawEditor.*ssr:\\s*false"
    - from: "components/TldrawEditor.tsx"
      to: "localStorage"
      via: "getSnapshot/loadSnapshot with throttled persistence"
      pattern: "localStorage\\.(getItem|setItem)"
    - from: "components/TldrawEditor.tsx"
      to: "tldraw store"
      via: "store.listen for changes"
      pattern: "store\\.listen"
---

<objective>
Create the workspace view with three-panel layout (problem panel, canvas, chat area) and integrate tldraw canvas with session persistence.

Purpose: Provide the main working environment where users can draw and solve problems on an infinite canvas.
Output: Functional workspace with resizable panels and a fully working tldraw canvas that persists during session.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/vincentngo/dev/cruzhacks/.planning/PROJECT.md
@/Users/vincentngo/dev/cruzhacks/.planning/ROADMAP.md
@/Users/vincentngo/dev/cruzhacks/.planning/REQUIREMENTS.md
@/Users/vincentngo/dev/cruzhacks/.planning/phases/01-foundation-canvas/01-RESEARCH.md
@/Users/vincentngo/dev/cruzhacks/.planning/phases/01-foundation-canvas/01-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create three-panel workspace layout</name>
  <files>
    app/workspace/page.tsx
    components/workspace/ProblemPanel.tsx
    components/workspace/CanvasPanel.tsx
  </files>
  <action>
    Create workspace page with three resizable panels using react-resizable-panels. Canvas should be visually dominant (~80% width).

    Create app/workspace/page.tsx:
    - Mark as 'use client' (uses dynamic import and interactive components)
    - Import dynamic from 'next/dynamic'
    - Import Panel, PanelGroup, PanelResizeHandle from 'react-resizable-panels'
    - Dynamically import TldrawEditor with ssr: false and loading fallback
    - Layout: full screen height (h-screen)
    - PanelGroup direction="horizontal"
    - Three panels:
      1. Left (Problem Panel): defaultSize=20, minSize=15, maxSize=30
      2. PanelResizeHandle with hover effect (Tailwind: bg-gray-200 hover:bg-blue-400)
      3. Center (Canvas Panel): defaultSize=80 (takes remaining space)
    - Note: Chat panel (right side) will be added in Phase 3

    Create components/workspace/ProblemPanel.tsx:
    - Placeholder component for Phase 1
    - Background: light gray (bg-gray-50)
    - Padding and structure
    - Heading: "Problem" (serif font)
    - Placeholder text: "Problem content will appear here in Phase 2" or similar
    - Height: full (h-full)

    Create components/workspace/CanvasPanel.tsx:
    - Simple wrapper component
    - Renders TldrawEditor (passed as children or direct import)
    - Height: full (h-full)
    - Position: relative (for canvas positioning)

    IMPORTANT: TldrawEditor must be dynamically imported in workspace/page.tsx with ssr: false to avoid hydration errors.
  </action>
  <verify>
    Run `npm run dev` and navigate to localhost:3000/workspace.
    Verify:
    - Three-panel layout displays
    - Problem panel on left (~20% width)
    - Canvas area on right (~80% width)
    - Resize handle between panels is draggable
    - Panels resize smoothly when dragging handle
    - Loading fallback shows briefly before canvas loads
  </verify>
  <done>
    Workspace displays three-panel layout, panels are resizable, canvas area is visually dominant, no layout issues or console errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate tldraw canvas with persistence</name>
  <files>
    components/TldrawEditor.tsx
  </files>
  <action>
    Create tldraw canvas component with localStorage persistence and minimal UI following RESEARCH.md patterns.

    Create components/TldrawEditor.tsx:
    - Mark as 'use client'
    - Import Tldraw, createTLStore, loadSnapshot, getSnapshot, createShapeId from 'tldraw'
    - Import 'tldraw/tldraw.css' (CRITICAL - canvas won't render properly without this)
    - Import useLayoutEffect, useMemo from 'react'

    Implementation:
    1. Create store: const store = useMemo(() => createTLStore(), [])
    2. In useLayoutEffect:
       - Load persisted state from localStorage key 'socratic-whiteboard-canvas'
       - If exists, use loadSnapshot(store, JSON.parse(persisted))
       - Listen to store changes with throttle (500ms)
       - On change, save getSnapshot(store) to localStorage
       - Return cleanup function to stop listening
    3. Create custom throttle function (500ms delay) - DO NOT use lodash to avoid extra dependency
    4. Render Tldraw component:
       - Pass store prop
       - Hide UI components via components prop:
         - ContextMenu: null
         - ActionsMenu: null
         - HelpMenu: null
         - MainMenu: null
         - StylePanel: null
         - Toolbar: keep visible (undefined)
       - Add onMount handler to create welcome hint text if canvas is empty
    5. Welcome hint (only if canvas empty):
       - Use editor.getCurrentPageShapeIds().size === 0 to check
       - Create text shape: "Start working on your problem here..."
       - Position at x: 200, y: 200
       - Style: size 'm', color 'grey'
    6. Wrapper div: className="fixed inset-0" for full coverage

    CRITICAL IMPLEMENTATION DETAILS:
    - Must import 'tldraw/tldraw.css' or canvas will be unstyled
    - Throttle saves to 500ms (not every change) to avoid performance issues
    - Use loadSnapshot/getSnapshot (not manual serialization) to handle shapes correctly
    - Dynamic import with ssr: false in parent component prevents SSR errors

    DO NOT:
    - Forget CSS import (causes invisible/broken canvas)
    - Save on every change (causes performance issues)
    - Check `typeof window !== 'undefined'` in render (causes hydration errors)
  </action>
  <verify>
    Run `npm run dev` and navigate to localhost:3000/workspace.
    Verify canvas functionality:
    1. tldraw canvas renders in center panel
    2. Welcome hint text appears on first load
    3. Drawing toolbar is visible at top
    4. Can select pen tool and draw
    5. Can select shapes and add rectangles/circles
    6. Can select eraser and remove shapes
    7. Draw something, refresh page - drawing persists
    8. No console errors about window, localStorage, or hydration
    9. Canvas is styled correctly (not blank/broken)

    Open DevTools:
    - Application > Local Storage - verify 'socratic-whiteboard-canvas' key exists
    - Network tab - verify tldraw CSS loads
    - Console - no errors
  </verify>
  <done>
    tldraw canvas renders with proper styling, all drawing tools work (pen, shapes, eraser), drawings persist across page refresh, welcome hint appears on empty canvas, no errors.
  </done>
</task>

</tasks>

<verification>
Complete workspace verification:
1. Navigate to localhost:3000/workspace
2. See three-panel layout with proper sizing
3. See welcome hint text on canvas
4. Use pen tool to draw on canvas
5. Add shapes (rectangle, circle)
6. Erase some content
7. Refresh page - all work persists
8. Drag resize handle - panels resize smoothly
9. No console errors or warnings
10. Canvas styling is correct (toolbar visible, professional appearance)
</verification>

<success_criteria>
1. Three-panel workspace layout renders correctly
2. Canvas is visually dominant (80% width)
3. Panels are resizable via drag handle
4. tldraw canvas renders with proper styling
5. All drawing tools work (pen, shapes, eraser)
6. Canvas state persists across page refreshes via localStorage
7. Welcome hint text appears on empty canvas
8. Minimal UI (menus hidden, toolbar visible)
9. No hydration errors or runtime errors
10. Performance is smooth (no lag during drawing)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-canvas/01-03-SUMMARY.md`
</output>
